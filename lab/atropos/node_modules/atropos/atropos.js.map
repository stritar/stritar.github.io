{"version":3,"file":"atropos.js.map","sources":["../src/atropos.js"],"sourcesContent":["/* eslint-disable no-restricted-globals */\nconst $ = (el, sel) => el.querySelector(sel);\nconst $$ = (el, sel) => el.querySelectorAll(sel);\nconst $setDuration = (el, duration) => {\n  el.style.transitionDuration = duration;\n};\nconst $setTransform = (el, transform) => {\n  el.style.transform = transform;\n};\nconst $setOpacity = (el, opacity) => {\n  el.style.opacity = opacity;\n};\nconst $on = (el, event, handler, props) => el.addEventListener(event, handler, props);\nconst $off = (el, event, handler, props) => el.removeEventListener(event, handler, props);\n\nconst removeUndefinedProps = (obj = {}) => {\n  const result = {};\n  Object.keys(obj).forEach((key) => {\n    if (typeof obj[key] !== 'undefined') result[key] = obj[key];\n  });\n  return result;\n};\n\nfunction Atropos(originalParams = {}) {\n  let { el, eventsEl } = originalParams;\n\n  const self = {\n    __atropos__: true,\n    params: {\n      activeOffset: 50,\n      shadowOffset: 50,\n      shadowScale: 1,\n      durationEnter: 300,\n      durationLeave: 600,\n      rotateLock: true,\n      rotate: true,\n      rotateTouch: true,\n      rotateXMax: 15,\n      rotateYMax: 15,\n      rotateXInvert: false,\n      rotateYInvert: false,\n      shadow: true,\n      highlight: true,\n      onEnter: null,\n      onLeave: null,\n      onRotate: null,\n      ...removeUndefinedProps(originalParams || {}),\n    },\n    destroyed: false,\n    isActive: false,\n  };\n\n  const { params } = self;\n\n  let rotateEl;\n  let rotated;\n  let scaleEl;\n  let innerEl;\n\n  let enterRotateX;\n  let enterRotateY;\n\n  let elBoundingClientRect;\n\n  let rotateXLock = true;\n  let rotateYLock = true;\n\n  let shadowEl;\n  let highlightEl;\n\n  const createShadow = () => {\n    let created;\n    shadowEl = $(el, '.atropos-shadow');\n    if (!shadowEl) {\n      shadowEl = document.createElement('span');\n      shadowEl.classList.add('atropos-shadow');\n      created = true;\n    }\n    $setTransform(\n      shadowEl,\n      `translate3d(0,0,-${params.shadowOffset}px) scale(${params.shadowScale})`,\n    );\n    if (created) {\n      rotateEl.appendChild(shadowEl);\n    }\n  };\n  const createHighlight = () => {\n    let created;\n    highlightEl = $(el, '.atropos-highlight');\n    if (!highlightEl) {\n      highlightEl = document.createElement('span');\n      highlightEl.classList.add('atropos-highlight');\n      created = true;\n    }\n\n    $setTransform(highlightEl, `translate3d(0,0,0)`);\n    if (created) {\n      innerEl.appendChild(highlightEl);\n    }\n  };\n\n  const setChildrenOffset = ({\n    rotateXPercentage = 0,\n    rotateYPercentage = 0,\n    duration,\n    opacityOnly,\n  }) => {\n    const getOpacity = (element) => {\n      if (element.dataset.atroposOpacity && typeof element.dataset.atroposOpacity === 'string') {\n        return element.dataset.atroposOpacity.split(';').map((v) => parseFloat(v));\n      }\n      return undefined;\n    };\n    $$(el, '[data-atropos-offset], [data-atropos-opacity]').forEach((childEl) => {\n      $setDuration(childEl, duration);\n      const elementOpacity = getOpacity(childEl);\n      if (rotateXPercentage === 0 && rotateYPercentage === 0) {\n        if (!opacityOnly) $setTransform(childEl, `translate3d(0, 0, 0)`);\n        if (elementOpacity) $setOpacity(childEl, elementOpacity[0]);\n      } else {\n        const childElOffset = parseFloat(childEl.dataset.atroposOffset) / 100;\n        if (!Number.isNaN(childElOffset) && !opacityOnly) {\n          $setTransform(\n            childEl,\n            `translate3d(${-rotateYPercentage * -childElOffset}%, ${\n              rotateXPercentage * -childElOffset\n            }%, 0)`,\n          );\n        }\n        if (elementOpacity) {\n          const [min, max] = elementOpacity;\n          const rotatePercentage = Math.max(\n            Math.abs(rotateXPercentage),\n            Math.abs(rotateYPercentage),\n          );\n          $setOpacity(childEl, min + ((max - min) * rotatePercentage) / 100);\n        }\n      }\n    });\n  };\n\n  const onPointerEnter = (e) => {\n    if (e.type === 'pointerdown' && e.pointerType === 'mouse') return;\n    if (e.type === 'pointerenter' && e.pointerType !== 'mouse') return;\n    if (e.type === 'pointerdown') {\n      e.preventDefault();\n    }\n    el.classList.add('atropos-active');\n    $setDuration(rotateEl, '0ms');\n    rotated = false;\n    enterRotateX = undefined;\n    enterRotateY = undefined;\n    rotateXLock = true;\n    rotateYLock = true;\n    $setTransform(scaleEl, `translate3d(0,0, ${params.activeOffset}px)`);\n    $setDuration(scaleEl, `${params.rotateLock ? params.durationEnter : 0}ms`);\n    if (shadowEl) {\n      $setDuration(shadowEl, `${params.rotateLock ? params.durationEnter : 0}ms`);\n    }\n\n    self.isActive = true;\n    if (typeof params.onEnter === 'function') params.onEnter();\n  };\n\n  const onTouchMove = (e) => {\n    if (rotated && e.cancelable) {\n      e.preventDefault();\n    }\n  };\n\n  const onPointerMove = (e) => {\n    if (!params.rotate || !self.isActive) return;\n    if (e.pointerType !== 'mouse') {\n      if (!params.rotateTouch) return;\n      e.preventDefault();\n    }\n    const { clientX, clientY } = e;\n    if (!elBoundingClientRect) {\n      elBoundingClientRect = el.getBoundingClientRect();\n    }\n    const { top, left, width, height } = elBoundingClientRect;\n    const centerX = width / 2;\n    const centerY = height / 2;\n\n    const coordX = clientX - left;\n    const coordY = clientY - top;\n\n    let rotateY = ((params.rotateYMax * (coordX - centerX)) / (width / 2)) * -1;\n    let rotateX = (params.rotateXMax * (coordY - centerY)) / (height / 2);\n    if (params.rotateLock) {\n      if (typeof enterRotateY === 'undefined') {\n        enterRotateY = rotateY;\n        rotateYLock = true;\n      }\n      if (typeof enterRotateX === 'undefined') {\n        enterRotateX = rotateX;\n        rotateXLock = true;\n      }\n      if (rotateYLock) {\n        if (enterRotateY < 0) {\n          if (rotateY < 0) rotateY = 0;\n          if (rotateY > 0) rotateYLock = false;\n        }\n        if (enterRotateY > 0) {\n          if (rotateY > 0) rotateY = 0;\n          if (rotateY < 0) rotateYLock = false;\n        }\n      }\n      if (rotateXLock) {\n        if (enterRotateX < 0) {\n          if (rotateX < 0) rotateX = 0;\n          if (rotateX > 0) rotateXLock = false;\n        }\n        if (enterRotateX > 0) {\n          if (rotateX > 0) rotateX = 0;\n          if (rotateX < 0) rotateXLock = false;\n        }\n      }\n    }\n\n    rotateX = Math.min(Math.max(-rotateX, -params.rotateXMax), params.rotateXMax);\n    if (params.rotateXInvert) rotateX = -rotateX;\n    rotateY = Math.min(Math.max(-rotateY, -params.rotateYMax), params.rotateYMax);\n    if (params.rotateYInvert) rotateY = -rotateY;\n\n    if (typeof params.rotateTouch === 'string' && (rotateX !== 0 || rotateY !== 0)) {\n      if (!rotated) {\n        rotated = true;\n        el.classList.add('atropos-rotate-touch');\n      }\n      if (e.cancelable) {\n        e.preventDefault();\n      }\n    }\n    $setTransform(rotateEl, `translate3d(0,0,0) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`);\n\n    const rotateXPercentage = (rotateX / params.rotateXMax) * 100;\n    const rotateYPercentage = (rotateY / params.rotateYMax) * 100;\n\n    if (highlightEl) {\n      $setDuration(highlightEl, '0ms');\n      $setTransform(\n        highlightEl,\n        `translate3d(${-rotateYPercentage * 0.25}%, ${rotateXPercentage * 0.25}%, 0)`,\n      );\n      highlightEl.style.opacity =\n        Math.max(Math.abs(rotateXPercentage), Math.abs(rotateYPercentage)) / 100;\n    }\n\n    setChildrenOffset({ rotateXPercentage, rotateYPercentage, duration: '0ms' });\n\n    if (typeof params.onRotate === 'function') params.onRotate(rotateX, rotateY);\n  };\n\n  const onPointerLeave = (e) => {\n    elBoundingClientRect = undefined;\n    if (!self.isActive) return;\n    if (e && e.type === 'pointerup' && e.pointerType === 'mouse') return;\n    if (e && e.type === 'pointerleave' && e.pointerType !== 'mouse') return;\n    if (typeof params.rotateTouch === 'string' && rotated) {\n      el.classList.remove('atropos-rotate-touch');\n    }\n    el.classList.remove('atropos-active');\n    $setTransform(scaleEl, `translate3d(0,0, ${0}px)`);\n    $setDuration(scaleEl, `${params.durationLeave}ms`);\n    if (shadowEl) {\n      $setDuration(shadowEl, `${params.durationLeave}ms`);\n    }\n    if (highlightEl) {\n      $setDuration(highlightEl, `${params.durationLeave}ms`);\n      $setTransform(highlightEl, `translate3d(0, 0, 0)`);\n      highlightEl.style.opacity = 0;\n    }\n    $setDuration(rotateEl, `${params.durationLeave}ms`);\n    $setTransform(rotateEl, `translate3d(0,0,0) rotateX(0deg) rotateY(0deg)`);\n\n    setChildrenOffset({ duration: `${params.durationLeave}ms` });\n    self.isActive = false;\n    if (typeof params.onRotate === 'function') params.onRotate(0, 0);\n    if (typeof params.onLeave === 'function') params.onLeave();\n  };\n\n  const onDocumentClick = (e) => {\n    const clickTarget = e.target;\n    if (!el.contains(clickTarget) && clickTarget !== el && self.isActive) {\n      onPointerLeave();\n    }\n  };\n\n  const initDOM = () => {\n    if (typeof el === 'string') {\n      el = $(document, el);\n    }\n    if (!el) return;\n\n    // eslint-disable-next-line\n    if (el.__atropos__) return;\n\n    if (typeof eventsEl !== 'undefined') {\n      if (typeof eventsEl === 'string') {\n        eventsEl = $(document, eventsEl);\n      }\n    } else {\n      eventsEl = el;\n    }\n\n    Object.assign(self, {\n      el,\n    });\n\n    rotateEl = $(el, '.atropos-rotate');\n    scaleEl = $(el, '.atropos-scale');\n    innerEl = $(el, '.atropos-inner');\n\n    // eslint-disable-next-line\n    el.__atropos__ = self;\n  };\n\n  const init = () => {\n    initDOM();\n    if (!el || !eventsEl) return;\n    if (params.shadow) {\n      createShadow();\n    }\n    if (params.highlight) {\n      createHighlight();\n    }\n    if (params.rotateTouch) {\n      if (typeof params.rotateTouch === 'string') {\n        el.classList.add(`atropos-rotate-touch-${params.rotateTouch}`);\n      } else {\n        el.classList.add('atropos-rotate-touch');\n      }\n    }\n    if ($(el, '[data-atropos-opacity]')) {\n      setChildrenOffset({ opacityOnly: true });\n    }\n    $on(document, 'click', onDocumentClick);\n    $on(eventsEl, 'pointerdown', onPointerEnter);\n    $on(eventsEl, 'pointerenter', onPointerEnter);\n    $on(eventsEl, 'pointermove', onPointerMove);\n    $on(eventsEl, 'touchmove', onTouchMove);\n    $on(eventsEl, 'pointerleave', onPointerLeave);\n    $on(eventsEl, 'pointerup', onPointerLeave);\n    $on(eventsEl, 'lostpointercapture', onPointerLeave);\n  };\n\n  const destroy = () => {\n    self.destroyed = true;\n    $off(document, 'click', onDocumentClick);\n    $off(eventsEl, 'pointerdown', onPointerEnter);\n    $off(eventsEl, 'pointerenter', onPointerEnter);\n    $off(eventsEl, 'pointermove', onPointerMove);\n    $off(eventsEl, 'touchmove', onTouchMove);\n    $off(eventsEl, 'pointerleave', onPointerLeave);\n    $off(eventsEl, 'pointerup', onPointerLeave);\n    $off(eventsEl, 'lostpointercapture', onPointerLeave);\n    // eslint-disable-next-line\n    delete el.__atropos__;\n  };\n\n  self.destroy = destroy;\n\n  init();\n\n  // eslint-disable-next-line\n  return self;\n}\nexport { Atropos };\nexport default Atropos;\n"],"names":["$","el","sel","querySelector","$$","querySelectorAll","$setDuration","duration","style","transitionDuration","$setTransform","transform","$setOpacity","opacity","$on","event","handler","props","addEventListener","$off","removeEventListener","removeUndefinedProps","obj","result","Object","keys","forEach","key","Atropos","originalParams","eventsEl","self","__atropos__","params","activeOffset","shadowOffset","shadowScale","durationEnter","durationLeave","rotateLock","rotate","rotateTouch","rotateXMax","rotateYMax","rotateXInvert","rotateYInvert","shadow","highlight","onEnter","onLeave","onRotate","destroyed","isActive","rotateEl","rotated","scaleEl","innerEl","enterRotateX","enterRotateY","elBoundingClientRect","rotateXLock","rotateYLock","shadowEl","highlightEl","createShadow","created","document","createElement","classList","add","appendChild","createHighlight","setChildrenOffset","rotateXPercentage","rotateYPercentage","opacityOnly","getOpacity","element","dataset","atroposOpacity","split","map","v","parseFloat","undefined","childEl","elementOpacity","childElOffset","atroposOffset","Number","isNaN","min","max","rotatePercentage","Math","abs","onPointerEnter","e","type","pointerType","preventDefault","onTouchMove","cancelable","onPointerMove","clientX","clientY","getBoundingClientRect","top","left","width","height","centerX","centerY","coordX","coordY","rotateY","rotateX","onPointerLeave","remove","onDocumentClick","clickTarget","target","contains","initDOM","assign","init","destroy"],"mappings":"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"}